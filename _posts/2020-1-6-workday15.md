---
layout:     post
title:      workday15
subtitle:   
date:       2020-1-6
author:     RJ
header-img: 
catalog: true
tags:
    - job

---
<p id = "build"></p>
---

# 今日工作安排：

1. 调试FASPell代码，厘清各部分功能。
2. 关注影响模型可调节的超参数
3. 跟进上一位同学的调试结果

# FASPell project

## 工作目录

```
FASPell/
  - bert_modified/
      - create_data.py
      - create_tf_record.py
      - modeling.py
      - tokenization.py
  - data/
      - char_meta.txt
  - model/
      - fine-tuned/
          - model.ckpt-10000.data-00000-of-00001
          - model.ckpt-10000.index
          - model.ckpt-10000.meta
      - pre-trained/
          - bert_config.json
          - bert_model.ckpt.data-00000-of-00001
          - bert_model.ckpt.index
          - bert_model.ckpt.meta
          - vocab.txt
  - plots/
      ...
  - char_sim.py
  - faspell.py
  - faspell_configs.json
  - masked_lm.py
  - plot.py
```

## 配置参数
```

{
  "general_configs": {
    "rank": 4,
    "round": 1,
    "weights": {
      "visual": 0,
      "phonological": 1
    },
    "char_meta": "data/char_meta.txt",
    "lm": {
      "max_seq": 128,
      "top_n": 5,
      "batch_size": 5,
      "vocab": "model/pre-trained/vocab.txt",
      "bert_configs": "model/pre-trained/bert_config.json",
      "pre-trained": "model/pre-trained/bert_model.ckpt",
      "fine-tuned": "model/fine-tuned_nlp/model.ckpt-1200",
      "fine_tuning_is_on": true
    }
  },
  "exp_configs": {
    "union_of_sims": false,
    "testing_set": "./data/test_nlp.txt",
    "training_set": "./data/train_final.txt",
    "tackle_n_gram_bias": true,
    "dump_candidates": "",
    "read_from_dump": false,
    "filter_is_on": true,
    "store_plots": "plots/sound_false",
    "store_latex": ""
  }
}
```

## 运行流程：
```
$ cd bert_modified
$ python create_data.py -f /path/to/training/data/file
$ python create_tf_record.py 
                            --input_file correct.txt 
                            --wrong_input_file wrong.txt 
                            --output_file  tf_examples.tfrecord 
                            --vocab_file   ../model/pre-trained/vocab.txt


python3 run_pretraining.py \
      --input_file=/tmp/tf_examples.tfrecord \
      --output_dir=/tmp/pretraining_output \
      --do_train=True \
      --do_eval=True \
      --bert_config_file=./tmp/model/bert_config.json \
      --init_checkpoint=./tmp/model/bert_model.ckpt \
      --train_batch_size=32 \
      --max_seq_length=128 \
      --max_predictions_per_seq=20 \
      --num_train_steps=20 \
      --num_warmup_steps=10 \
      --learning_rate=2e-5
```

## issue问题
在github的issue中，大部分问题都围绕着char_meta.txt这个文件，因为这个文件没有开源，而且这个文件是是CSD即confidence-similarity-Decoder的关键，大家都在围绕这个问题讨论。

这个文件的格式如下：

unicode
```
U+5E74	年	ning4,nian2;nin4;NYEN;NEN;nên	⿱⿰丿一⿻⿳一丨一丨
U+725B	牛	niu2;ngau4;WU;GYUU;ngưu	⿻⿰丿一⿻一丨
U+5343	千	qian1;cin1;CHEN;SEN;thiên	⿱丿⿻一丨
U+7530	田	tian2;tin4;CEN;DEN,TEN;điền	⿵⿰丨𠃌⿱⿻一丨一
U+7531	由	you2,yao1;jau4;YU;YUU,YUI,YU;do	⿻⿰丨𠃌⿱⿻一丨一
U+5348	午	wu3;ng5;O;GO;ngọ	⿱⿰丿一⿻一丨
```